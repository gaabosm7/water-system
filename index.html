<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ù…ÙŠØ§Ù‡ Ù‚Ø±ÙŠØ© Ø§Ù„Ø¬Ø¹ÙˆØ¯ÙŠØ©</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; margin: 0; padding: 20px; }
        .nav { background: #333; padding: 10px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 10px; }
        .nav button { background: #555; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; }
        .nav button:hover { background: #007bff; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: center; }
        th { background: #007bff; color: white; }
        .negative { color: red; font-weight: bold; }
        input, select { padding: 8px; margin: 5px; width: 200px; }
        .btn-save { background: #28a745; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="nav">
        <button onclick="loadDashboard()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button onclick="loadCustomers()">ğŸ‘¥ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</button>
        <button onclick="showUsersReport()">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
        <button onclick="loadExpenses()">ğŸ’¸ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</button>
    </div>

    <div id="content" class="card">
        </div>

    <script>
        const API_URL = ""; // Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†

        function loadDashboard() {
            fetch('/dashboard/')
            .then(res => res.json())
            .then(data => {
                document.getElementById('content').innerHTML = `
                    <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                        <div class="card" style="background:#e3f2fd"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„</h3><p>${data.total_income} Ø±ÙŠØ§Ù„</p></div>
                        <div class="card" style="background:#fbe9e7"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3><p>${data.total_expenses} Ø±ÙŠØ§Ù„</p></div>
                        <div class="card" style="background:#e8f5e9"><h3>Ø§Ù„Ø±ØµÙŠØ¯ ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</h3><p>${data.box_balance} Ø±ÙŠØ§Ù„</p></div>
                        <div class="card" style="background:#fff3e0"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†</h3><p style="color:red">${data.total_debts} Ø±ÙŠØ§Ù„</p></div>
                    </div>
                `;
            });
        }

        function showUsersReport() {
            fetch('/users_report/')
            .then(res => res.json())
            .then(data => {
                let html = `<h2>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† ÙˆØ§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ø´ØªØ±Ùƒ</th>
                            <th>Ø§Ù„Ø¹Ø¯Ø§Ø¯</th>
                            <th>Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th>
                            <th>Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</th>
                            <th>Ø¢Ø®Ø± Ù…Ø¨Ù„Øº</th>
                            <th>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</th>
                            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>`;
                data.forEach(u => {
                    const balClass = u.wallet_balance < 0 ? 'negative' : '';
                    html += `
                        <tr>
                            <td>${u.full_name}</td>
                            <td>${u.serial_number}</td>
                            <td>${u.prev_r}</td>
                            <td>${u.curr_r}</td>
                            <td>${u.consumption}</td>
                            <td>${u.last_amount}</td>
                            <td class="${balClass}">${u.wallet_balance}</td>
                            <td>${u.note || '-'}</td>
                        </tr>`;
                });
                html += `</tbody></table>`;
                document.getElementById('content').innerHTML = html;
            });
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ù‚Ø±Ø§Ø¡Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        function addReadingPrompt(meterId) {
            const val = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:");
            const note = prompt("Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):");
            if(val) {
                fetch('/readings/', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({meter_id: meterId, current_reading: parseInt(val), note: note})
                }).then(res => res.json()).then(data => {
                    alert(data.message || data.detail);
                    showUsersReport();
                });
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
        window.onload = loadDashboard;
    </script>
</body>
</html>
